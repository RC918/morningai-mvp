# 基於角色的存取控制 (RBAC) 實作摘要

## 1. 概述

本文件概述了 MorningAI MVP 專案中基於角色的存取控制 (RBAC) 功能的實作細節。RBAC 是一種安全機制，透過為用戶分配特定角色來限制其對系統資源的存取權限，從而提高系統的安全性和管理效率。

## 2. 實作方法

RBAC 的實作主要涉及修改資料模型、在認證模組中添加角色檢查邏輯，並在 Flask 應用程式中應用權限裝飾器。具體步驟如下：

### 2.1. 資料模型修改 (`models.py`)

*   **User 模型**：在 `User` 模型中添加了一個 `role` 欄位，用於儲存用戶的角色資訊（例如 'user', 'admin'）。此欄位預設值為 'user'。

### 2.2. 認證模組修改 (`auth.py`)

*   **`has_role` 函數**：新增 `has_role(user_id, required_role)` 函數，用於檢查指定用戶是否具有所需的角色。
*   **`role_required` 裝飾器**：新增 `role_required(required_role)` 裝飾器。此裝飾器用於保護 Flask 路由，確保只有具有指定角色的用戶才能存取該路由。它會解析 JWT 以獲取當前用戶 ID，然後呼叫 `has_role` 函數進行權限檢查。如果用戶不具備所需角色，則返回 403 Forbidden 錯誤。

### 2.3. Flask 應用程式整合 (`main.py`)

*   **`role_required` 裝飾器應用**：在需要進行角色權限控制的路由上應用 `@role_required("角色名稱")` 裝飾器。例如，`@app.route("/admin-only", methods=["GET"])
@jwt_required()
@role_required("admin")` 確保只有 'admin' 角色的用戶才能存取 `/admin-only` 端點。
*   **用戶註冊**：在用戶註冊時，預設會為其分配 'user' 角色。管理員可以手動修改用戶角色。

## 3. 測試

RBAC 功能的測試是中期改進測試的一部分，確保了角色權限控制的正確性。測試涵蓋了以下場景：

*   普通用戶嘗試存取管理員專用端點時被拒絕 (403 Forbidden)。
*   管理員用戶成功存取管理員專用端點 (200 OK)。
*   用戶註冊時預設角色為 'user'。

## 4. 結論

透過實作基於角色的存取控制，MorningAI MVP 專案能夠精細化管理用戶權限，確保不同角色的用戶只能存取其被授權的資源，從而顯著提升了應用程式的安全性。

